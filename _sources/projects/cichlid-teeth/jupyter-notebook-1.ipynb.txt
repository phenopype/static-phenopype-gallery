{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Cichlid teeth\n",
    "\n",
    "For a more detailed description see: <https://www.phenopype.org/gallery/projects/cichlid-teeth/>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Single tooth case\n",
    "\n",
    "These images are quite variable in their background, and thus the contrast to the tooth contained inside changes from image to image. This makes it hard for signal processing, but the SAM algorithm is very good at detecting edges, so it should be able to deal with this variation. We need to load the fastSAM repo to the Python path before loading phenopype so it is recognized and the plugin properly loaded.  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "phenopype successfully imported the following plugin dependencies:\n",
      "torch, fastsam\n"
     ]
    }
   ],
   "source": [
    "import sys\n",
    "sys.path.append(r'D:\\git-repos\\mluerig\\FastSAM')\n",
    "\n",
    "import phenopype as pp\n",
    "import os \n",
    "\n",
    "## my root directory - modify as needed\n",
    "os.chdir(r\"D:\\science\\packages\\phenopype\\phenopype-gallery_exec\")\n",
    "\n",
    "## my laptop has a small screen, so I use a smaller phenopype window\n",
    "pp._config.window_max_dim = 800"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Make phenopype project\n",
    "\n",
    "Create a phenopype project (remember, `Project` is used to both create new projects, and load existing ones). Different phenopype projects can be useful, e.g., to process different batches of images from field seasons, perspectives, etc,. It makes sense to create them side by side in a subfolder, which I call \"phenopype\". Thus, my research projects often have the following directory structure (just my way of working - this is really totally up to you):\n",
    "\n",
    "```\n",
    "my-project\n",
    "    data                       # processed data (e.g., tables)\n",
    "    data_raw                   # raw data (images, videos, etc.)\n",
    "    phenopype                  # phenopype projects\n",
    "    phenopype_templates        # phenopype .yaml config templates\n",
    "    scripts                    # python, R, etc.\n",
    "    [...]                      # manuscripts, figures, literature, etc.\n",
    "```"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "--------------------------------------------\n",
      "Found existing project root directory - loading from:\n",
      "D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\n",
      "\n",
      "Checks for directory completeness passed!\n",
      "\n",
      "Project \"cichlid-teeth-1\" successfully loaded with 16 images\n",
      "--------------------------------------------\n"
     ]
    }
   ],
   "source": [
    "proj = pp.Project(r\"phenopype\\cichlid-teeth-1\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "## add tooth-images from the data folder, but exclude the images containing multiple teeth \n",
    "proj.add_files(image_dir = r\"data_raw\\cichlid-teeth\", include=[\"depth\", \"Depth\"], include_all=False, mode=\"link\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "proj.add_config(template_path=r\"phenopype_templates\\cichlid-teeth_template1.yaml\", tag=\"v1\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We need to add the fastSAM model that is saved in the github repo:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\models\\model_a.pt\n",
      "Saved model info to project attributes.\n",
      "- setting active project model to a\n"
     ]
    }
   ],
   "source": [
    "proj.add_model(\"D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "## run image processing\n",
    "for path in proj.dir_paths:\n",
    "    pp.Pype(path, tag=\"v1\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "file \"canvas\": found 16 results in 16 project folders\n",
      "file \"shape\": found 16 results in 16 project folders\n",
      "Saving file shape_v1.csv\n"
     ]
    }
   ],
   "source": [
    "proj.collect_results(files=[\"canvas\", \"shape\"], tag=\"v1\", aggregate_csv=True, overwrite=True)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Add alternative configuration\n",
    "\n",
    "Phenopype can also the fastSAM model without box prompts, i.e., use the entire image. This can be useful when you only have single objects inside your images. First we need to add another configuration (make sure to supply another `tag`), otherwise your old config will be overwritten."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_16\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_18\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_depth_42\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_42_\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_depth_68\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_706\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710_13\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710_15\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_712_12\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_722_2\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_722_4\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_762_24\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_26\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_42\\pype_config_v2.yaml\n",
      "- template saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_49\\pype_config_v2.yaml\n"
     ]
    }
   ],
   "source": [
    "proj.add_config(template_path=r\"phenopype_templates\\cichlid-teeth_template2.yaml\", tag=\"v2\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now run the config with interactive mode off (`feedback=False`)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n",
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:42 +++--------------\n",
      "\n",
      "==> image name: LV1_Depth_16.jpg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n",
      "0: 1024x1024 2 objects, 488.6ms\n",
      "Speed: 8.0ms preprocess, 488.6ms inference, 388.9ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_16\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:46 +++--------------\n",
      "\n",
      "==> image name: LV1_Depth_18.jpg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 3 objects, 506.0ms\n",
      "Speed: 6.1ms preprocess, 506.0ms inference, 8.9ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_18\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:49 +++--------------\n",
      "\n",
      "==> image name: LV1_depth_42.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 520.9ms\n",
      "Speed: 7.0ms preprocess, 520.9ms inference, 5.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_depth_42\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:51 +++--------------\n",
      "\n",
      "==> image name: LV1_Depth_42_.jpg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 3 objects, 467.4ms\n",
      "Speed: 6.6ms preprocess, 467.4ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_Depth_42_\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:53 +++--------------\n",
      "\n",
      "==> image name: LV1_depth_68.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 543.3ms\n",
      "Speed: 9.1ms preprocess, 543.3ms inference, 5.5ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__LV1_depth_68\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:56 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_706.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 510.9ms\n",
      "Speed: 6.9ms preprocess, 510.9ms inference, 7.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_706\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:03:58 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_710.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 548.5ms\n",
      "Speed: 7.1ms preprocess, 548.5ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:00 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_710_13.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 469.1ms\n",
      "Speed: 8.0ms preprocess, 469.1ms inference, 4.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710_13\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:02 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_710_15.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 552.2ms\n",
      "Speed: 7.0ms preprocess, 552.2ms inference, 5.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_710_15\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:05 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_712_12.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 494.6ms\n",
      "Speed: 8.1ms preprocess, 494.6ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_712_12\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:07 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_722_2.jpg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 464.6ms\n",
      "Speed: 7.0ms preprocess, 464.6ms inference, 5.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_722_2\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:09 +++--------------\n",
      "\n",
      "==> image name: lv1_depth_722_4.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 481.1ms\n",
      "Speed: 8.1ms preprocess, 481.1ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv1_depth_722_4\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:12 +++--------------\n",
      "\n",
      "==> image name: lv2_depth_762_24.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 480.4ms\n",
      "Speed: 6.0ms preprocess, 480.4ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_762_24\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:14 +++--------------\n",
      "\n",
      "==> image name: lv2_depth_766_26.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 496.7ms\n",
      "Speed: 7.0ms preprocess, 496.7ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_26\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:16 +++--------------\n",
      "\n",
      "==> image name: lv2_depth_766_42.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 2 objects, 467.3ms\n",
      "Speed: 6.0ms preprocess, 467.3ms inference, 6.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_42\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n",
      "\n",
      "AUTOLOAD\n",
      "- loaded info for 1 models ('a',) \n",
      "- set model \"a\" as default model (change with \"activate=True\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "------------+++ new pype iteration 2023-11-14 11:04:18 +++--------------\n",
      "\n",
      "==> image name: lv2_depth_766_49.jpeg\n",
      "predict_SAM\n",
      "Using current model at D:\\git-repos\\mluerig\\FastSAM\\FastSAM-x.pt\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "0: 1024x1024 1 object, 472.8ms\n",
      "Speed: 7.2ms preprocess, 472.8ms inference, 5.0ms postprocess per image at shape (1, 3, 1024, 1024)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "found 1 objects!\n",
      "morphology\n",
      "detect_contour\n",
      "- found 1 contours that match criteria\n",
      "compute_shape_features\n",
      "select_canvas\n",
      "- raw image\n",
      "draw_contour\n",
      "export_csv\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- exported csv for type contour\n",
      "- exported csv for type shape_features\n",
      "\n",
      "\n",
      "------------+++ finished pype iteration +++--------------\n",
      "-------(End with Ctrl+Enter or re-run with Enter)--------\n",
      "\n",
      "\n",
      "\n",
      "AUTOSAVE\n",
      "- save_canvas\n",
      "- image saved under D:\\science\\packages\\phenopype\\phenopype-gallery_exec\\phenopype\\cichlid-teeth-1\\data\\0__lv2_depth_766_49\\canvas_v2.jpg.\n",
      "- save_annotation\n",
      "- creating new annotation file\n",
      "- no annotation_type selected - exporting all annotations\n",
      "- writing annotations of type \"contour\" with id \"a\" to \"annotations_v2.json\"\n",
      "- writing annotations of type \"shape_features\" with id \"a\" to \"annotations_v2.json\"\n"
     ]
    }
   ],
   "source": [
    "for path in proj.dir_paths: \n",
    "    p = pp.Pype(\n",
    "        image_path=path, \n",
    "        tag=\"v2\", \n",
    "        feedback=False,             # turn off feedback for automatic mode \n",
    "        )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "file \"canvas\": found 16 results in 16 project folders\n",
      "file \"shape\": found 16 results in 16 project folders\n",
      "Saving file shape_v2.csv\n"
     ]
    }
   ],
   "source": [
    "proj.collect_results(files=[\"canvas\", \"shape\"], tag=\"v2\", aggregate_csv=True, overwrite=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.18"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
